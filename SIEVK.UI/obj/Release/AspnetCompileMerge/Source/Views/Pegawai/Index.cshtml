<!DOCTYPE html>
<html>
<head>
    
    <meta name="viewport" content="width=device-width" />
    <title>List Pegawai</title>
    
    <script>
        var deleteStatus = true;
        var IDdelete = 0;

        function getFullName(data, type, dataToSet) {
            return data.FirstName + " " + data.LastName;
        }

        $(document).ready(function () {
           
        $('[data-toggle="tooltip"]').tooltip();

        $("#listpegawai").DataTable({

            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "pageLength": 10,
            "scrollCollapse": true,
            "scrollX": true,
            "scrollY": "350px", //cukup untuk 10 row
            "ajax": {
                //"url": rootUrl + "/Pegawai/LoadDataPegawai",
                "url": '@Url.Content("~/")' +"Pegawai/LoadDataPegawai",
                "type": "POST",
                "datatype": "json"
            },

            "columnDefs":
                [{
                 "targets": [7],
                 "className": "text-center",
                 "searchable": false,
                 "orderable": false
                 //"width": "4%"
                }],

            "columns": [
                  { "data": "NIP", "name": "NIP", "autoWidth": true },
                  { "data": "KdUnit", "name": "KdUnit", "autoWidth": true },
                { "data": "NAMA", "name": "NAMA", "autoWidth": true },
                { "data": "PANGKAT", "name": "PANGKAT" },
                { "data": "ALAMAT", "name": "ALAMAT", "autoWidth": true },
                { "data": "JABATAN", "name": "JABATAN", "autoWidth": true },
                { "data": "PDDK", "name": "PDDK", "autoWidth": true },
                  {
                      "render": function (data, type, full, meta) {
                          return '<a class="btn btn-md btn-info icon-search" data-toggle="tooltip" data-placement="top" title="Lihat Detail" href="@Url.Action("Detail", "Pegawai")' + "?nip=" + full.NIP + '"></a> &nbsp' +                              
                              '<a class="btn btn-md btn-success icon-edit" data-toggle="tooltip" data-placement="top" title="Ubah Data" href="@Url.Action("Edit", "Pegawai")' + "?nip=" + full.NIP + '"></a> &nbsp' +
                              "<a class='OpenModal btn btn-md btn-danger icon-trash' data-toggle='tooltip' data-placement='top' title='Hapus Data' data-nama='" + full.NAMA + "' data-id='" + full.NIP + "' href='#confirm-delete'></a>";
                      }
                  },
            ]

        });
    });

    @*function DeleteData(ID) {
        if (confirm("Are you sure you want to delete ...?")) {
            Delete(ID);
        }
        else {
            return false;
        }
    }


    function Delete(ID) {
        var url = '@Url.Content("~/")' + "Pegawai/Delete";
            $.post(url, { ID: ID }, function (data) {
                if (data == "Deleted") {
                    alert("Delete User Successfully !");
                    oTable = $('#listpegawai').DataTable();
                    oTable.draw();
                }
                else {
                    alert("Something Went Wrong! Error" + data);
                }
            });
    }*@

        $(document).on("click", ".btn-ok", function (e) {
             if (deleteStatus == true) //only 1 working in 1 click ok function
             {
                 var url = '@Url.Content("~/")' + "Pegawai/Delete";
                 $.post(url, { NIP: IDdelete }, function (data) {
                     if (data == "Deleted") {
                         oTable = $('#listpegawai').DataTable();
                         oTable.draw();
                         addAlert();
                     }
                     else {
                         alert("Terjadi kesalahan! Error" + data);
                     }
                 });
                 deleteStatus = false;
                 $('#confirm-delete').modal('hide');//if success then hide
             }

         })

        function addAlert() {
            var nama = $(".NAMA").text();
            var div = document.createElement('div');
            div.className = 'alert alert-success';
            div.innerHTML =
                '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\
                 Pegawai <b>' + nama + '</b> berhasil dihapus.';

            document.getElementsByClassName("alert-delete")[0].appendChild(div);
        }

        $(document).on("click", ".OpenModal", function (e) {

                baseUrl = @Html.Raw(HttpUtility.JavaScriptStringEncode(
               new Uri(
                  new Uri(this.Context.Request.Url.GetLeftPart(UriPartial.Authority)),
                  Url.Content("~/")
              ).ToString(), true))

                e.preventDefault();
                deleteStatus = true;
                var _self = $(this);
                var idUser = _self.data('id');
                IDdelete = idUser; //set yang akan dihapus
                var nama = _self.data('nama');
                //$(".btn-ok").attr('href', baseUrl + '//Pegawai//DeleteUser//' + idUser + ''); //default
                $(".NAMA").text(nama);
               
                @*$(".btn-ok").click(function () {
                    if (deleteStatus == true) //only 1 working in 1 click ok function
                    {
                        debugger
                        alert(_self.data('id'));
                        var url = '@Url.Content("~/")' + "Pegawai/Delete";
                        $.post(url, { ID: IDdelete }, function (data) {
                            if (data == "Deleted") {
                                oTable = $('#listpegawai').DataTable();
                                oTable.draw();
                            }
                            else {
                                alert("Something Went Wrong! Error" + data);
                            }
                        });
                        deleteStatus = false;
                        $(_self.attr('href')).modal('hide'); //if success then hide
                    }

                })*@

                $(_self.attr('href')).modal('show');
        });


    </script>

</head>
<body>
    <div class="span12">
        @if (!Html.ViewData.ModelState.IsValid)
        {
            <div class="alert alert-danger">
                @Html.ValidationSummary()
            </div>
        }

        @if (ViewBag.Info != "" && ViewBag.Info != null)
        {
            <div class="alert alert-success">@ViewBag.Info</div>
        }
        <div class="alert-delete"></div>
        <div class="widget">
            <div class="widget-header">
                <i class="icon-list-alt"></i>
                <h3>List Pegawai</h3>
            </div>
            <div class="widget-content">
                <table id="listpegawai" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0">
                    <thead>
                        <tr>
                            <th>NIP</th>
                            <th>Kode Unit</th>
                            <th>Nama</th>
                            <th>Pangkat</th>
                            <th>Alamat</th>
                            <th>Jabatan</th>
                            <th>Pendidikan</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Konfirmasi Hapus</h4>
                </div>

                <div class="modal-body">
                    <p>Apakah anda yakin menghapus pegawai <b><i class="username"></i></b> ?</p>
                    <p class="debug-url"></p>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Batal</button>
                    <a class="btn btn-danger btn-ok">Hapus</a>
                    @*<button type="button" id="btn_ok_1" class="btn btn-primary">Delete</button>*@
                </div>
            </div>
        </div>
    </div>
</body>
</html>  
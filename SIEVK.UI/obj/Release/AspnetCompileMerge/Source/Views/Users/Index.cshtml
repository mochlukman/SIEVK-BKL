

<!DOCTYPE html>
<html>
<head>
    
    <meta name="viewport" content="width=device-width" />
    <title>List Users</title>
    
    <script>
        var deleteStatus = true;
        var IDdelete = 0;

        function getFullName(data, type, dataToSet) {
            return data.FirstName + " " + data.LastName;
        }

        $(document).ready(function () {
           
        $('[data-toggle="tooltip"]').tooltip();

        $("#listusers").DataTable({

            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "pageLength": 10,
            "ajax": {
                //"url": rootUrl + "/Users/LoadDataUsers",
                "url": '@Url.Content("~/")' +"Users/LoadDataUsers",
                "type": "POST",
                "datatype": "json"
            },

            "columnDefs":
            [{
                "targets": [0],
                "visible": false,
                "searchable": false
            },
             {
                 "targets": [7],
                 "className": "text-center",
                 "searchable": false,
                 "orderable": false
                 //"width": "4%"
             }],

            "columns": [
                  { "data": "ID", "name": "ID", "autoWidth": true },
                  { "data": "UserGroupName", "name": "UserGroupName", "autoWidth": true },
                  { "data": "KdUnit", "name": "KdUnit", "autoWidth": true },
                  { "data": "UserName", "name": "UserName", "autoWidth": true },
                  { "data": getFullName, "name": "FullName", "autoWidth": true },
                  { "data": "IsActiveText", "name": "IsActiveText", "autoWidth": true },
                  { "data": "Email", "name": "Email", "autoWidth": true },
                  {
                      "render": function (data, type, full, meta) {
                          return '<a class="btn btn-md btn-info icon-search" data-toggle="tooltip" data-placement="top" title="Lihat Detail" href="@Url.Action("Detail", "Users")' + "?userName=" + full.UserName + '"></a> &nbsp' +
                              '<a class="btn btn-md btn-success icon-lock" data-toggle="tooltip" data-placement="top" title="Ubah Password" href="@Url.Action("ChangePassword", "Users")' + "?userName=" + full.UserName + '"></a> &nbsp' +
                              '<a class="btn btn-md btn-success icon-edit" data-toggle="tooltip" data-placement="top" title="Ubah User" href="@Url.Action("Edit", "Users")' + "?userName=" + full.UserName + '"></a> &nbsp' +
                              "<a class='OpenModal btn btn-md btn-danger icon-trash' data-toggle='tooltip' data-placement='top' title='Hapus user' data-username='" + full.UserName + "' data-id='" + full.ID + "' href='#confirm-delete'></a>";
                      }
                  },
            ]

        });
    });

    @*function DeleteData(ID) {
        if (confirm("Are you sure you want to delete ...?")) {
            Delete(ID);
        }
        else {
            return false;
        }
    }


    function Delete(ID) {
        var url = '@Url.Content("~/")' + "Users/Delete";
            $.post(url, { ID: ID }, function (data) {
                if (data == "Deleted") {
                    alert("Delete User Successfully !");
                    oTable = $('#listusers').DataTable();
                    oTable.draw();
                }
                else {
                    alert("Something Went Wrong! Error" + data);
                }
            });
    }*@

        $(document).on("click", ".btn-ok", function (e) {
             if (deleteStatus == true) //only 1 working in 1 click ok function
             {
                 var url = '@Url.Content("~/")' + "Users/Delete";
                 $.post(url, { ID: IDdelete }, function (data) {
                     if (data == "Deleted") {
                         oTable = $('#listusers').DataTable();
                         oTable.draw();
                         addAlert();
                     }
                     else {
                         alert("Terjadi kesalahan! Error" + data);
                     }
                 });
                 deleteStatus = false;
                 $('#confirm-delete').modal('hide');//if success then hide
             }

         })

        function addAlert() {
            var userName = $(".username").text();
            var div = document.createElement('div');
            div.className = 'alert alert-success';
            div.innerHTML =
                '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\
                 Username <b>' + userName + '</b> berhasil dihapus.';

            document.getElementsByClassName("alert-delete")[0].appendChild(div);
        }

        $(document).on("click", ".OpenModal", function (e) {

                baseUrl = @Html.Raw(HttpUtility.JavaScriptStringEncode(
               new Uri(
                  new Uri(this.Context.Request.Url.GetLeftPart(UriPartial.Authority)),
                  Url.Content("~/")
              ).ToString(), true))

                e.preventDefault();
                deleteStatus = true;
                var _self = $(this);
                var idUser = _self.data('id');
                IDdelete = idUser; //set yang akan dihapus
                var username = _self.data('username');
                //$(".btn-ok").attr('href', baseUrl + '//Users//DeleteUser//' + idUser + ''); //default
                $(".username").text(username);
               
                @*$(".btn-ok").click(function () {
                    if (deleteStatus == true) //only 1 working in 1 click ok function
                    {
                        debugger
                        alert(_self.data('id'));
                        var url = '@Url.Content("~/")' + "Users/Delete";
                        $.post(url, { ID: IDdelete }, function (data) {
                            if (data == "Deleted") {
                                oTable = $('#listusers').DataTable();
                                oTable.draw();
                            }
                            else {
                                alert("Something Went Wrong! Error" + data);
                            }
                        });
                        deleteStatus = false;
                        $(_self.attr('href')).modal('hide'); //if success then hide
                    }

                })*@

                $(_self.attr('href')).modal('show');
        });


    </script>

</head>
<body>
    <div class="span12">
        @if (!Html.ViewData.ModelState.IsValid)
        {
            <div class="alert alert-danger">
                @Html.ValidationSummary()
            </div>
        }

        @if (ViewBag.Info != "" && ViewBag.Info != null)
        {
            <div class="alert alert-success">@ViewBag.Info</div>
        }
        <div class="alert-delete"></div>
        <div class="widget">
            <div class="widget-header">
                <i class="icon-list-alt"></i>
                <h3>List User</h3>
            </div>
            <div class="widget-content">
                <table id="listusers" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nama Group</th>
                            <th>Kode Unit</th>
                            <th>Username</th>
                            <th>Nama</th>
                            <th>Status</th>
                            <th>Email</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Konfirmasi Hapus</h4>
                </div>

                <div class="modal-body">
                    <p>Apaakah anda yakin menghapus username <b><i class="username"></i></b> ?</p>
                    <p class="debug-url"></p>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Batal</button>
                    <a class="btn btn-danger btn-ok">Hapus</a>
                    @*<button type="button" id="btn_ok_1" class="btn btn-primary">Delete</button>*@
                </div>
            </div>
        </div>
    </div>
</body>
</html>  
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>List User Groups</title>

    <script>
        var deleteStatus = true;
        var IDdelete = 0;
        $(document).ready(function () {
           
        $("#listUserGroups").DataTable({

            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "pageLength": 10,

            "ajax": {
                //"url": rootUrl + "/UserGroups/LoadDataUserGroups",
                "url": '@Url.Content("~/")' + "UserGroups/LoadDataUserGroups",
                "type": "POST",
                "datatype": "json"
            },

            "columnDefs":
            [{
                "targets": [0],
                "visible": false,
                "searchable": false
            },
            {
                "targets": [3],
                "searchable": false,
                "className": "text-center",
                "width": "14%",
                "orderable": false
            }
            ],

            "columns": [
                  { "data": "ID", "name": "ID", "autoWidth": true },
                  { "data": "GroupName", "name": "GroupName", "autoWidth": true },
                  { "data": "IsActiveText", "name": "IsActiveText", "autoWidth": true },
                  {
                      "render": function (data, type, full, meta)
                      {
                          return '<a class="btn btn-md btn-info icon-search" data-toggle="tooltip" data-placement="top" title="Lihat Detail" href="@Url.Action("Detail", "UserGroups")' + "?id=" + full.ID + '"></a> &nbsp;' +
                          '<a class="btn btn-md btn-success icon-lock" data-toggle="tooltip" data-placement="top" title="Ubah Hak Akses" href="@Url.Action("EditPrivilege", "UserGroups")' + "?userGroupsId=" + full.ID + '"></a> &nbsp;' +   
                          '<a class="btn btn-md btn-success icon-edit" data-toggle="tooltip" data-placement="top" title="Ubah User Group" href="@Url.Action("Edit", "UserGroups")' + "?id=" + full.ID + '"></a> &nbsp;' +
                          '<a class="OpenModal btn btn-md btn-danger icon-trash" data-toggle="tooltip" data-placement="top" title="Hapus User Group" data-groupname="' + full.GroupName + '" data-id="' + full.ID + '" href="#confirm-delete"></a>';
                      }
                  },

            ]

        });
    });

        $(document).on("click", ".btn-ok", function (e) {
             if (deleteStatus == true) //only 1 working in 1 click ok function
             {
                 var url = '@Url.Content("~/")' + "UserGroups/Delete";
                 $.post(url, { ID: IDdelete }, function (data) {
                     if (data == "Deleted") {
                         oTable = $('#listUserGroups').DataTable();
                         oTable.draw();
                         // add alert after delete
                         addAlert();
                     }
                     else {
                         alert("Terjadi kesalahan! Error" + data);
                     }
                 });
                 deleteStatus = false;
                 $('#confirm-delete').modal('hide');//if success then hide
             }

         })

        $(document).on("click", ".OpenModal", function (e) {
                e.preventDefault();
                deleteStatus = true;
                var _self = $(this);
                var idMenu = _self.data('id');
                IDdelete = idMenu; //set yang akan dihapus
                var groupName = _self.data('groupname');
                $(".groupName").text(groupName);

                $(_self.attr('href')).modal('show');
        });

        function addAlert() {
            var groupName = $(".groupName").text();
            var div = document.createElement('div');
            div.className = 'alert alert-success';
            div.innerHTML =
                '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\
                 Nama group <b>'+ groupName  +'</b> berhasil dihapus.';

            document.getElementsByClassName("alert-delete")[0].appendChild(div);
        }


    </script>

</head>
<body>

    <div class="span12">

        @if (!Html.ViewData.ModelState.IsValid)
        {
            <div class="alert alert-danger">
                @Html.ValidationSummary()
            </div>
        }

        @if (ViewBag.Info != "" && ViewBag.Info != null)
        {
            <div class="alert alert-success">@ViewBag.Info</div>
        }

        <div class="alert-delete"></div>
        <div class="widget">
            <div class="widget-header">
                <i class="icon-list-alt"></i>
                <h3>List User Groups</h3>
            </div>
            <div class="widget-content">
                <table id="listUserGroups" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nama Group</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Konfirmasi Hapus</h4>
                </div>

                <div class="modal-body">
                    <p>Apakah anda yakin menghapus nama group <b><i class="groupName"></i></b> ?</p>
                    <p class="debug-url"></p>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Batal</button>
                    <a class="btn btn-danger btn-ok">Hapus</a>
                </div>
            </div>
        </div>
    </div>

</body>
</html>  
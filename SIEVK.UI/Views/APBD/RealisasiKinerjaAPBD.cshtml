@{
    ViewBag.Title = "APBD - Realisasi Kinerja APBD";
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <script>
    var deleteStatus = true;
    var IDdelete = 0;

    var unitKey = '@ViewBag.unitKey';
    var kdTahap = '@ViewBag.kdTahap';
    var kdTahun = '@ViewBag.kdTahun';
    var idPrgrm = '@ViewBag.idPrgrm';
    var idKeg = '@ViewBag.idKeg';
    var nuKeg_nmKeg = '@ViewBag.nuKeg_nmKeg';

    $(document).ready(function () {

        $('[data-toggle="tooltip"]').tooltip();
        $("#UnitKodeSelected").val('@ViewBag.unitKey')
        $("#UnitNameSelected").val('@ViewBag.unitOrgName')
        $("#unitorganisasi-flexdatalist").val('@ViewBag.unitOrgName')

        $("#IDPrgrmSelected").val('@ViewBag.idPrgrm')
        $("#NMPrgrmSelected").val('@ViewBag.prgrmName')
        $("#program-flexdatalist").val('@ViewBag.prgrmName')

        var textdetail = document.getElementById('txtDetailInfo');
        textdetail.innerHTML = '@ViewBag.nuKeg_nmKeg';

        $("#list").DataTable({
            "processing": false, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "pageLength": 10,
            "scrollCollapse": true,
            "scrollX": true,
            "scrollY": "350px", //cukup untuk 10 row
            "ajax": {
                "url": '@Url.Content("~/")' + "APBD/LoadDataRealisasiKinerjaAPBD",
                "type": "POST",
                "datatype": "json",
                "data": {
                    "unitKey": function () { return $('#UnitKodeSelected').val() },
                    "kdTahap": function () { return $('#TahapanCombo').val() },
                    "kdTahun": function () { return $('#TahunAnggaranCombo').val() },
                    "idPrgrm": function () { return $('#IDPrgrmSelected').val() }
                }
            },
            "columnDefs":
            [
            {
                "targets": [4,5],
                "searchable": true,
                "orderable": true,
                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                    var $currencyCell = $(nTd);
                    var commaValue = $currencyCell.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1.");
                    $currencyCell.text(commaValue);
                },
                "className": "text-right",
            },
            {
                "targets": [7, 8, 9, 10],
                "visible": false,
                "searchable": false
            }
            ],
            "fixedColumns": {
                "leftColumns": 0
            },
            "columns": [
                  { "data": "NUKEG", "name": "NUKEG", "autoWidth": true }, //bisa ditamhakan title
                  { "data": "NMKEG", "name": "NMKEG", "autoWidth": true },
                  { "data": "URKIN", "name": "URKIN", "autoWidth": true },
                  { "data": "TARGET", "name": "TARGET", "autoWidth": true },
                  { "data": "PAGU", "name": "PAGU", "autoWidth": true },
                  { "data": "LOKASI", "name": "LOKASI", "autoWidth": true },
                  {
                      "render": function (data, type, full, meta) {
                          return '<a class="btn btn-md btn-success icon-edit" data-toggle="tooltip" data-placement="top" title="Ubah Kegiatan Unit" href="@Url.Action("KegUnitAPBDEdit", "APBD")' + "?unitKey=" + full.UNITKEY + "&kdTahap=" + full.KDTAHAP + "&kdTahun=" + full.KDTAHUN + "&idPrgrm=" + $("#IDPrgrmSelected").val() + "&idKeg=" + full.IDKEG + "&kdTrwn=" + full.KDTRWN + '"></a>&nbsp;';
                      }
                  },
                  { "data": "KDTAHAP", "name": "KDTAHAP", "autoWidth": true }, //hide
                  { "data": "KDTAHUN", "name": "KDTAHUN", "autoWidth": true }, //hide
                  { "data": "UNITKEY", "name": "UNITKEY", "autoWidth": true }, //hide
                  { "data": "IDKEG", "name": "IDKEG", "autoWidth": true }, //hide

            ]

        });

        $("#listdetail").DataTable({
            "processing": false, // for show progress bar
            "serverSide": true, // for process server side
            "filter": false, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "paging": false, //supaya tidak keluar combo total row selectednya, ada custom di code behind
            "scrollCollapse": true,
            "scrollX": true,
            "scrollY": "350px", //cukup untuk 10 row
            "ajax": {
                "url": '@Url.Content("~/")' + "APBD/LoadDataRealisasiKinerjaAPBDDetail",
                "type": "POST",
                "datatype": "json",
                "data": {
                    "unitKey": function () { return unitKey },
                    "kdTahap": function () { return kdTahap },
                    "kdTahun": function () { return kdTahun },
                    "idKeg": function () { return idKeg }
                }
            },
            "columnDefs":
            [
            {
                "targets": [0, 1, 2, 3, 4, 5],
                "searchable": false,
                "orderable": false,
                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                    var $currencyCell = $(nTd);
                    var commaValue = $currencyCell.text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
                    //var commaValue = $currencyCell.text().match(/(\d)(/^(?!0+\.00)(?=.{1,9}(\.|$))(?!0(?!\.))\d{1,3}(,\d{3})*(\.\d+)?$/));//replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
                    $currencyCell.text(commaValue);
                },
                "className": "text-right",
            },
            {
                "targets": [3],
                "data" : null,
                "render": function (data, type, row) {
                    return row.REALSTR + ' ' + row.SATUAN + '; ' + row.REALSTR1 +' '+ row.SATUAN1;
                },
            },
            {
                "targets": [7, 8, 9, 10, 11,12,13,14,15],
                "visible": false,
                "orderable": false,
                "searchable": false
            },
             {
                 "targets": [6],
                 "orderable": false,
                 "className": "text-center"
             }
            ],
            "columns": [
                  { "data": "NMTRWN", "name": "NMTRWN", "autoWidth": true },
                  { "data": "REALNUM", "name": "REALNUM", "autoWidth": true },
                  { "data": "REALFISIK", "name": "REALFISIK", "autoWidth": true },
                  { "data" : null, "name": "REALISASIKINERJA", "autoWidth": true },
                  { "data": "MASALAH", "name": "MASALAH", "autoWidth": true },
                  { "data": "SOLUSI", "name": "SOLUSI", "autoWidth": true },
                  {
                      "render": function (data, type, full, meta) {
                          //var textdetail = document.getElementById('txtDetailInfo');
                          //textdetail.innerHTML = full.NUKEG + ' - ' + full.NMKEG
                          return '<a class="btn btn-md btn-success icon-edit" data-toggle="tooltip" data-placement="top" title="Ubah Realisasi" href="@Url.Action("RealisasiKinerjaAPBDEdit", "APBD")' + "?unitKey=" + full.UNITKEY + "&kdTahap=" + full.KDTAHAP + "&kdTahun=" + full.KDTAHUN + "&idPrgrm=" + $("#IDPrgrmSelected").val() + "&idKeg=" + full.IDKEG + "&kdTrwn=" + full.KDTRWN + '"></a>&nbsp;' +
                          '<a class="OpenModal btn btn-md btn-danger icon-trash" data-toggle="tooltip" data-placement="top" title="Hapus Realisasi" data-kdtrwn="' + full.KDTRWN + '" data-nmtrwn="' + full.NMTRWN + '" href="#confirm-delete"></a>';

                      }
                },

                { "data": "REALSTR", "name": "REALSTR", "autoWidth": true }, //hide
                { "data": "SATUAN", "name": "SATUAN", "autoWidth": true }, //hide
                { "data": "REALSTR1", "name": "KDTRWN", "autoWidth": true }, //hide
                { "data": "SATUAN1", "name": "SATUAN1", "autoWidth": true }, //hide

                  { "data": "IDKEG", "name": "IDKEG", "autoWidth": true }, //hide
                  { "data": "UNITKEY", "name": "UNITKEY", "autoWidth": true }, //hide
                  { "data": "KDTAHAP", "name": "KDTAHAP", "autoWidth": true }, //hide
                  { "data": "KDTAHUN", "name": "KDTAHUN", "autoWidth": true }, //hide
                { "data": "KDTRWN", "name": "KDTRWN", "autoWidth": true }, //hide


            ]
        });

        $("#listdetail2").DataTable({
            "processing": false, // for show progress bar
            "serverSide": true, // for process server side
            "filter": false, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "paging": false, //supaya tidak keluar combo total row selectednya, ada custom di code behind
            "scrollCollapse": true,
            "scrollX": true,
            "scrollY": "350px", //cukup untuk 10 row
            "ajax": {
                "url": '@Url.Content("~/")' + "APBD/LoadDataKinKegUnitAPBD",
                "type": "POST",
                "datatype": "json",
                "data": {
                    "unitKey": function () { return unitKey },
                    "kdTahap": function () { return kdTahap },
                    "kdTahun": function () { return kdTahun },
                    "idKeg": function () { return idKeg }
                }
            },
            "columnDefs":
            [
            {
                "targets": [6, 7, 8, 9],
                "visible": false,
                "orderable": false,
                "searchable": false
            }
            ],
            "columns": [
                { "data": "NOURKIN", "name": "NOURKIN", "autoWidth": true },
                { "data": "URKIN", "name": "URKIN", "autoWidth": true },
                { "data": "TARGET", "name": "TARGET", "autoWidth": true },
                { "data": "REALISASI", "name": "REALISASI", "autoWidth": true },
                { "data": "KET", "name": "KET", "autoWidth": true },
                {
                    "render": function (data, type, full, meta) {
                        return '<a class="btn btn-md btn-success icon-edit" data-toggle="tooltip" data-placement="top" title="Ubah Kinerja Kegiatan Unit" href="@Url.Action("KinerjaKegiatanUnitAPBDEdit", "APBD")' + "?unitKey=" + full.UNITKEY + "&kdTahap=" + full.KDTAHAP + "&kdTahun=" + full.KDTAHUN + "&idKeg=" + full.IDKEG + "&noUrkin=" + full.NOURKIN + "&idPrgrm=" + $("#IDPrgrmSelected").val() + "&nuKeg_nmKeg=" + nuKeg_nmKeg+ '"></a>&nbsp;' +
                            '<a class="OpenModal2 btn btn-md btn-danger icon-trash" data-toggle="tooltip" data-placement="top" title="Hapus Kinerja Kegiatan Unit" data-nourkin="' + full.NOURKIN + '" data-urkin="' + full.URKIN + '" href="#confirm-delete2"></a>';

                    }
                },
                { "data": "IDKEG", "name": "IDKEG", "autoWidth": true }, //hide
                { "data": "UNITKEY", "name": "UNITKEY", "autoWidth": true }, //hide
                { "data": "KDTAHAP", "name": "KDTAHAP", "autoWidth": true }, //hide
                { "data": "KDTAHUN", "name": "KDTAHUN", "autoWidth": true }, //hide
            ]
        });

    });

    </script>

</head>
<body>
    @using (Html.BeginForm(null, null, FormMethod.Post, new { @class = "form-horizontal", @name = "frmRealisasiKinerjaAPBD", @ng_app = "APBDApp", @data_ng_controller = "validateCtrl" }))
    {
        <div class="span12">
            @if (!Html.ViewData.ModelState.IsValid)
            {
                <div class="alert alert-danger">
                    @Html.ValidationSummary()
                </div>
            }

            @if (ViewBag.Info != "" && ViewBag.Info != null)
            {
                <div class="alert alert-success">@ViewBag.Info</div>
            }
            <div class="alert-delete"></div>
            <div class="widget">
                <div class="widget-header">
                    <i class="icon-list-alt"></i>
                    <h3>Evaluasi APBD - Realisasi Kinerja APBD</h3>
                </div>
                <div class="widget-content">
                    <fieldset>
                        <div class="form-group">
                            <label class="control-label" for="Unit">Unit Organisasi</label>
                            <div class="controls-filter">
                                <input type="text" id="unitorganisasi" name="unitorganisasi" ng-invalid ng-model="unitorganisasi" class="form-control input-sm flexdatalist span6" placeholder='Isi Nama Unit Organisasi' required>
                                @Html.Hidden("UnitKodeSelected")
                                @Html.Hidden("UnitNameSelected")
                                <span style="color:maroon" ng-show="frmRealisasiKinerjaAPBD.unitorganisasi.$dirty && frmRealisasiKinerjaAPBD.unitorganisasi.$invalid">
                                    <span ng-show="frmRealisasiKinerjaAPBD.unitorganisasi.$error.required">Unit Organisasi harus diisi</span>
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label" for="TahapanCombo">Tahapan</label>
                            <div class="controls-filter">
                                @Html.DropDownList("TahapanCombo", null, new { @class = "form-control input-sm span2" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label" for="TahunAnggaranCombo">Tahun Anggaran</label>
                            <div class="controls-filter">
                                @Html.DropDownList("TahunAnggaranCombo", null, new { @class = "form-control input-sm span2" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label" for="Program">Program</label>
                            <div class="controls-filter">
                                <input type="text" id="program" name="program" ng-invalid ng-model="program" class="form-control input-sm flexdatalist-program span6" placeholder='Isi Nama Program' required>
                                @Html.Hidden("IDPrgrmSelected")
                                @Html.Hidden("NMPrgrmSelected")
                                <span style="color:maroon" ng-show="frmRealisasiKinerjaAPBD.program.$dirty && frmRealisasiKinerjaAPBD.program.$invalid">
                                    <span ng-show="frmRealisasiKinerjaAPBD.program.$error.required">Program harus diisi</span>
                                </span>

                            </div>
                        </div>
                        <div class="form-group">
                            <div class="controls-filter">
                                <button type="button" class="btn btn-primary" id="btnCari" ng-disabled="frmRealisasiKinerjaAPBD.$invalid"><i class="btn-icon-only icon-search"> Cari </i></button>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>

        <div class="span12">
            <div class="widget">
                <div class="widget-content">
                    <table id="list" class="table table-striped table-bordered dt-responsive nowrap header-cursor" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Kode</th>
                                <th>Kegiatan</th>
                                <th>Indikator Kerja</th>
                                <th>Target</th>
                                <th>Pagu</th>
                                <th>Lokasi</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>

        <div class="span12">
            <div class="widget">
                <div class="widget-content">
                    <label style="text-align: left" width="100%" id="txtDetailInfo"></label>

                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs pull-left">
                            <li class="active"><a href="#kinerjakegiatan" data-toggle="tab">Kinerja Kegiatan</a></li>
                            <li><a href="#evaluasikinerja" data-toggle="tab">Evaluasi Kinerja APBD</a></li>
                            <li class="pull-left header"></li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane" id="evaluasikinerja" style="position: relative;">
                                <table id="listdetail" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            @*<th>Target TW 1</th>
                                                <th>Real TW 1</th>
                                                <th>Target TW 2</th>
                                                <th>Real TW 2</th>
                                                <th>Target TW 3</th>
                                                <th>Real TW 3</th>
                                                <th>Target TW 4</th>
                                                <th>Real TW 4</th>*@
                                            <th>Periode</th>
                                            <th>Realisasi Anggaran</th>
                                            <th>Realisasi Fisik (%)</th>
                                            <th>Realisasi Kinerja</th>
                                            @*<th>Satuan</th>*@
                                            <th>Masalah</th>
                                            <th>Solusi</th>
                                            <th>Action</th>
                                            <th>Action1</th>
                                            <th>Action2</th>
                                            <th>Action3</th>
                                            <th>Action4</th>
                                        </tr>
                                    </thead>
                                </table>
                                <br>
                                <button type="button" style="display:none;" class="btn btn-success" id="btnTambah"><i class="btn-icon-only icon-plus"> Tambah </i></button>
                            </div>

                            <div class="tab-pane active" id="kinerjakegiatan" style="position: relative;">
                                <table id="listdetail2" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>Nomor</th>
                                            <th>Kinerja</th>
                                            <th>Target</th>
                                            <th>Realisasi</th>
                                            <th>Keterangan</th>
                                            <th>Action</th>
                                            <th>Action1</th>
                                            <th>Action2</th>
                                            <th>Action3</th>
                                            <th>Action4</th>
                                        </tr>
                                    </thead>
                                </table>
                                <br>
                                <button type="button" style="display:none;" class="btn btn-success" id="btnTambah2"><i class="btn-icon-only icon-plus"> Tambah </i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Konfirmasi Hapus</h4>
                    </div>

                    <div class="modal-body">
                        <p>Apakah anda yakin menghapus data realisasi <b><i class="nmtrwn"></i></b> ?</p>
                        <p class="debug-url"></p>
                        <input type="hidden" id="kdtrwnSelected" name="kdtrwnSelected" />
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Batal</button>
                        <a class="btn btn-danger btn-ok">Hapus</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="confirm-delete2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Konfirmasi Hapus</h4>
                    </div>

                    <div class="modal-body">
                        <p>Apakah anda yakin menghapus data Kinerja Kegiatan Unit <b><i class="urkin"></i></b> ?</p>
                        <p class="debug-url"></p>
                        <input type="hidden" id="nourkinSelected" name="nourkinSelected" />
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Batal</button>
                        <a class="btn btn-danger btn-ok2">Hapus</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="ModalExistData" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Informasi</h4>
                    </div>
                    <div class="modal-body">
                        <p>Data realisasi sudah ada.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    }
</body>
</html>

<script>
    jQuery(document).ready(function () {
        if ('@ViewBag.IsBack' == "True") { document.getElementById("btnTambah").style.display = "block"; document.getElementById("btnTambah2").style.display = "block"; }

        if ('@ViewBag.HasUnitKey' == "True") {
            document.getElementById("unitorganisasi-flexdatalist").disabled = true;
        }
        @*else
        {
            $('.flexdatalist').flexdatalist({
                cache: false,
                searchContain: true,
                textProperty: '{KDUNIT}' + ' ' + '{NMUNIT}',
                valueProperty: 'iso2',
                minLength: 0,
                focusFirstResult: true,
                selectionRequired: true,
                noResultsText: 'Tidak ada hasil untuk "{keyword}"',
                visibleProperties: ["KDUNIT", "NMUNIT"],
                searchIn: ["KDUNIT", "NMUNIT"],
                url: '@Url.Content("~/")' + 'APBD/GetUnitOrganization/',
                relatives: '#relative'
            }).on("select:flexdatalist", function (event, data) {
                $('#UnitKodeSelected').val(data.UNITKEY);
                $('#UnitNameSelected').val(data.NMUNIT);

                $('#program').val('').parent().find("ul.flexdatalist-multiple li.value").remove();
            });
        }*@

        jQuery("#btnTambah").click(function () {
            if (idPrgrm == '') {
                idPrgrm = $("#IDPrgrmSelected").val();
            }
            window.location.href = '@Url.Action("RealisasiKinerjaAPBDCreate", "APBD")' + "?unitKey=" + unitKey + "&kdTahap=" + kdTahap + "&kdTahUN=" + kdTahun + "&idPrgrm=" + idPrgrm + "&idKeg=" + idKeg;
            @*var table = $('#listdetail').DataTable();
            if (table.data().count() > 0) {
                $('#ModalExistData').modal('show');
            }
            else {
                window.location.href = '@Url.Action("RealisasiKinerjaAPBDCreate", "APBD")' + "?unitKey=" + unitKey + "&kdTahap=" + kdTahap + "&kdTahUN=" + kdTahun + "&idPrgrm=" + idPrgrm + "&idKeg=" + idKeg;
            }*@
        });

        jQuery("#btnTambah2").click(function () {
            if (idPrgrm == '') {
                idPrgrm = $("#IDPrgrmSelected").val();
            }
            window.location.href = '@Url.Action("KinerjaKegiatanUnitAPBDCreate", "APBD")' + "?unitKey=" + unitKey + "&kdTahap=" + kdTahap + "&kdTahun=" + kdTahun + "&idKeg=" + idKeg + "&idPrgrm=" + idPrgrm + "&nuKeg_nmKeg=" + nuKeg_nmKeg;
        });

        var table = $("#list").DataTable();
        $('#list tbody').on('click', 'tr', function () {
            var sData = table.row(this).data()
            unitKey = sData["UNITKEY"];
            kdTahap = sData["KDTAHAP"];
            kdTahun = sData["KDTAHUN"];
            idKeg = sData["IDKEG"];
            var textdetail = document.getElementById('txtDetailInfo');
            nuKeg_nmKeg = sData["NUKEG"] + ' - ' + sData["NMKEG"];
            textdetail.innerHTML = nuKeg_nmKeg;

            var tabledetail = $("#listdetail").DataTable();
            tabledetail.ajax.reload();

            var tabledetail2 = $("#listdetail2").DataTable();
            tabledetail2.ajax.reload();

            // show hide button after user click row
            document.getElementById("btnTambah").style.display = "block";
            document.getElementById("btnTambah2").style.display = "block";
        });

        //$('#kinerjakegiatan').click(function(){
        //    var tabledetail2 = $("#listdetail2").DataTable();
        //    tabledetail2.ajax.reload();
        //});

        //$('#evaluasikinerja').click(function() {
        //    var tabledetail = $("#listdetail").DataTable();
        //    tabledetail.ajax.reload();
        //});
    });



    //flexdatalist dipindah diluar onready supaya kalau back dari halaman edit bisa load textnya
    $('.flexdatalist').flexdatalist({
        cache: false,
        searchContain: true,
        textProperty: '{KDUNIT}' + ' ' + '{NMUNIT}',
        valueProperty: 'iso2',
        minLength: 0,
        focusFirstResult: true,
        selectionRequired: true,
        noResultsText: 'Tidak ada hasil untuk "{keyword}"',
        visibleProperties: ["KDUNIT", "NMUNIT"],
        searchIn: ["KDUNIT", "NMUNIT"],
        url: '@Url.Content("~/")' + 'APBD/GetUnitOrganization/',
        relatives: '#relative'
    }).on("select:flexdatalist", function (event, data) {
        $('#UnitKodeSelected').val(data.UNITKEY);
        $('#UnitNameSelected').val(data.NMUNIT);

        $('#program').val('').parent().find("ul.flexdatalist-multiple li.value").remove();
    });


    $("#TahapanCombo").change(function () {
        $('#program').val('').parent().find("ul.flexdatalist-multiple li.value").remove();
    });

    var paramsKey = { unitKey: "", kdTahun: "", kdTahap: "" };
    $('.flexdatalist-program').on('before:flexdatalist.data', function (event) {
        var uk = $('#UnitKodeSelected').val();
        var kt = $('#TahunAnggaranCombo').val();
        var kThp = $('#TahapanCombo').val();
        paramsKey = { unitKey: uk, kdTahun: kt, kdTahap: kThp }
        $('.flexdatalist-program').flexdatalist('params', paramsKey);
    });

    $('.flexdatalist-program').flexdatalist({
        cache: false,
        searchContain: true,
        textProperty: '{KDPRGRM}' + ' ' + '{NMPRGRM}',
        valueProperty: 'iso2',
        minLength: 0,
        focusFirstResult: true,
        selectionRequired: true,
        noResultsText: 'Tidak ada hasil untuk "{keyword}"',
        visibleProperties: ["NMPRGRM"],
        searchIn: ["KDPRGRM", "NMPRGRM"],
        url: '@Url.Content("~/")' + 'APBD/GetProgramAPBD/',
        params: paramsKey
    }).on("select:flexdatalist", function (event, data) {
        $('#IDPrgrmSelected').val(data.IDPRGRM);
        $('#NMPrgrmSelected').val(data.NMPRGRM);
        idPrgrm = data.IDPRGRM;

        if ('@ViewBag.HasUnitKey' != "True") {
            document.getElementById("btnCari").disabled = false;
        }

    });

    //sampai sini, sebelumnya didalam onready

    $("#btnCari").click(function () {
        kdTahap = "";
        kdTahun = "";
        idPrgrm = "";
        idKeg = "";

        var table = $("#list").DataTable();
        table.ajax.reload();

        // hide add button after user click seacrh button
        document.getElementById("btnTambah").style.display = "none";
        document.getElementById("btnTambah2").style.display = "none";
    });

    var app = angular.module('APBDApp', []);
    app.controller('validateCtrl', function ($scope) {
        $scope.unitorganisasi = '@ViewBag.unitOrgName';
    });

    //delete function
    $(document).on("click", ".btn-ok", function (e) {
        if (deleteStatus == true) //only 1 working in 1 click ok function
        {
            var url = '@Url.Content("~/")' + "APBD/DeleteRealisasiKinerjaAPBD";
            $.post(url, { unitkey: unitKey, kdtahapan: kdTahap, kdtahun: kdTahun, idkeg: idKeg, kdTrwn: $("#kdtrwnSelected").val() }, function (data) {
                if (data == "Deleted") {
                    oTable = $('#listdetail').DataTable();
                    oTable.draw();
                    // add alert after delete
                    addAlert();
                }
                else {
                    alert("Terjadi kesalahan! Error" + data);
                }
            });
            deleteStatus = false;
            $('#confirm-delete').modal('hide');//if success then hide
        }

        $("#unitorganisasi-flexdatalist").val('@ViewBag.unitOrgName')
    })

    $(document).on("click", ".btn-ok2", function (e) {
        if (deleteStatus == true) //only 1 working in 1 click ok function
        {
            var url = '@Url.Content("~/")' + "APBD/DeleteKinKegUnitAPBD";
            $.post(url, { unitkey: unitKey, kdTahap: kdTahap, kdtahun: kdTahun, idkeg: idKeg, noUrkin: $("#nourkinSelected").val() }, function (data) {
                if (data == "Deleted") {
                    oTable = $('#listdetail2').DataTable();
                    oTable.draw();
                    // add alert after delete
                    addAlert();
                }
                else {
                    alert("Terjadi kesalahan! Error" + data);
                }
            });
            deleteStatus = false;
            $('#confirm-delete2').modal('hide');//if success then hide
        }

        $("#unitorganisasi-flexdatalist").val('@ViewBag.unitOrgName')
    })

    $(document).on("click", ".OpenModal", function (e) {
        e.preventDefault();
        deleteStatus = true;
        var _self = $(this);
        var nmtrwn = _self.data('nmtrwn');
        var kdtrwn = _self.data('kdtrwn');
        $(".nmtrwn").text(nmtrwn);
        $("#kdtrwnSelected").val(kdtrwn);

        $(_self.attr('href')).modal('show');
    });


    $(document).on("click", ".OpenModal2", function (e) {
        e.preventDefault();
        deleteStatus = true;
        var _self = $(this);
        var urkin = _self.data('urkin');
        var nourkin = _self.data('nourkin');
        $(".urkin").text(urkin);
        $("#nourkinSelected").val(nourkin);

        $(_self.attr('href')).modal('show');
    });

    function addAlert() {
        var nmtrwn = $(".nmtrwn").text();
        var div = document.createElement('div');
        div.className = 'alert alert-success';
        div.innerHTML =
            '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\
                 Realisasi program <b>' + nmtrwn + '</b> berhasil dihapus.';

        document.getElementsByClassName("alert-delete")[0].appendChild(div);
    }


</script>